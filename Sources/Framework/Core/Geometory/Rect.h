//***********************************************************
//! @file
//! @brief		矩形
//! @author		Gajumaru
//***********************************************************
#pragma once
#include <Framework/Core/Math/Vector/include.h>

namespace ob {

    //@―---------------------------------------------------------------------------
    //! @brief      矩形
    //! 
    //! @details    矩形は内部的に中心座標とサイズで管理されます。
    //! @note       size が負の数の時は未定義動作です。
    //@―---------------------------------------------------------------------------
    struct OB_API Rect {
    public:

        //===============================================================
        //  コンストラクタ / デストラクタ
        //===============================================================

        //@―---------------------------------------------------------------------------
        //! @brief      デフォルトコンストラクタ(初期化なし)
        //@―---------------------------------------------------------------------------
        Rect() noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      コンストラクタ( ゼロ初期化 )
        //@―---------------------------------------------------------------------------
        explicit Rect(EForceInit) noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      コンストラクタ(サイズ/中心指定)
        //@―---------------------------------------------------------------------------
        Rect(const Vec2& center, const Vec2& size = Vec2::zero) noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      コンストラクタ(点群指定)
        //! 
        //! @details    指定された点群をすべて含むボックスを構築する
        //@―---------------------------------------------------------------------------
        Rect(const gsl::span<Vec2>& points) noexcept;


        //===============================================================
        //  オペレータ
        //===============================================================

        //@―---------------------------------------------------------------------------
        //! @brief      比較演算子
        //@―---------------------------------------------------------------------------
        bool operator==(const Rect& other)const noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief          ポイントを含むように矩形を拡大する
        //! 
        //! @param point    ポイント
        //@―---------------------------------------------------------------------------
        Rect operator+(const Vec2& point)const noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief          ポイントを含むように矩形を拡大する
        //! 
        //! @param point    ポイント
        //@―---------------------------------------------------------------------------
        Rect& operator+=(const Vec2& point) noexcept;


        //===============================================================
        //  セッター
        //===============================================================

        //@―---------------------------------------------------------------------------
        //! @brief      構造体の初期化
        //@―---------------------------------------------------------------------------
        void reset() noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      2点を指定して Rect を設定
        //@―---------------------------------------------------------------------------
        void setStartEnd(const Vec2& start, const Vec2& end) noexcept;


        //===============================================================
        //  ゲッター
        //===============================================================

        //@―---------------------------------------------------------------------------
        //! @brief      左上
        //@―---------------------------------------------------------------------------
        Vec2 tl()const noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      左上
        //@―---------------------------------------------------------------------------
        Vec2 tr()const noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      左下
        //@―---------------------------------------------------------------------------
        Vec2 bl()const noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      右下
        //@―---------------------------------------------------------------------------
        Vec2 br()const noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      上辺の中央
        //@―---------------------------------------------------------------------------
        Vec2 topCenter()const noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      下辺の中央
        //@―---------------------------------------------------------------------------
        Vec2 bottomCenter()const noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      左辺の中央
        //@―---------------------------------------------------------------------------
        Vec2 leftCenter()const noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      右辺の中央
        //@―---------------------------------------------------------------------------
        Vec2 rightCenter()const noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      幅
        //@―---------------------------------------------------------------------------
        f32 width()const noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      高さ
        //@―---------------------------------------------------------------------------
        f32 height()const noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      外周の長さ
        //@―---------------------------------------------------------------------------
        f32 area()const noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      外周の長さ
        //@―---------------------------------------------------------------------------
        f32 perimeter()const noexcept;


        //===============================================================
        //  判定
        //===============================================================

        //@―---------------------------------------------------------------------------
        //! @brief      サイズが0以下であるか
        //@―---------------------------------------------------------------------------
        bool isEmpty()const noexcept;


    public:

        //@―---------------------------------------------------------------------------
        //! @brief      2点を指定して Rect を作成する
        //@―---------------------------------------------------------------------------
        static Rect Create(const Vec2& start, const Vec2& end) noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief      補間
        //! 
        //! @param a    開始
        //! @param b    終了
        //! @param t    補間係数
        //! @return     t=0のときa、t=1の時bを返す。
        //@―---------------------------------------------------------------------------
        static Rect Lerp(const Rect& a, const Rect& b,f32 t) noexcept;


    public:

        Vec2 center;        //!< 中心座標
        Vec2 size;          //!< 矩形サイズ

    };






    //===============================================================
    // インライン関数
    //===============================================================
    //! @cond

    //@―---------------------------------------------------------------------------
    //! @brief      デフォルトコンストラクタ
    //@―---------------------------------------------------------------------------
    inline Rect::Rect() noexcept {
    }


    //@―---------------------------------------------------------------------------
    //! @brief      コンストラクタ( ゼロ初期化 )
    //@―---------------------------------------------------------------------------
    inline Rect::Rect(EForceInit) noexcept {
        reset();
    }


    //@―---------------------------------------------------------------------------
    //! @brief      コンストラクタ(サイズ/中心指定)
    //@―---------------------------------------------------------------------------
    inline Rect::Rect(const Vec2& size, const Vec2& center) noexcept
        : center(center)
        , size(Vec2::Abs(size)) {
    }


    //@―---------------------------------------------------------------------------
    //! @brief      比較演算子
    //@―---------------------------------------------------------------------------
    inline bool Rect::operator==(const Rect& other)const noexcept {
        return (center == other.center) && (size == other.size);
    }


    //@―---------------------------------------------------------------------------
    //! @brief          ポイントを含むように矩形を拡大する
    //! 
    //! @param point    ポイント
    //@―---------------------------------------------------------------------------
    inline Rect Rect::operator+(const Vec2& point)const noexcept {
        return Rect(*this) += point;
    }


    //@―---------------------------------------------------------------------------
    //! @brief          ポイントを含むように矩形を拡大する
    //! 
    //! @param point    ポイント
    //@―---------------------------------------------------------------------------
    inline Rect& Rect::operator+=(const Vec2& point) noexcept {
        Vec2 min = center - size * 0.5f;
        Vec2 max = center + size * 0.5f;

        min = Vec2::Min(min, point);
        max = Vec2::Min(max, point);

        center = (min + max) * 0.5f;
        size = max - min;

        return *this;
    }


    //@―---------------------------------------------------------------------------
    //! @brief      構造体のゼロ初期化
    //@―---------------------------------------------------------------------------
    inline void Rect::reset() noexcept {
        center.setZero();
        size.setZero();
    }


    //@―---------------------------------------------------------------------------
    //! @brief      2点を指定して Box を設定
    //@―---------------------------------------------------------------------------
    inline void Rect::setStartEnd(const Vec2& start, const Vec2& end) noexcept {
        center = (start + end) * 0.5f;
        size = Vec2::Abs(start - end);
    }


    //@―---------------------------------------------------------------------------
    //! @brief      左上
    //@―---------------------------------------------------------------------------
    inline Vec2 Rect::tl()const noexcept {
        return center + Vec2(-size.x * 0.5f, -size.y * 0.5f);
    }


    //@―---------------------------------------------------------------------------
    //! @brief      右上
    //@―---------------------------------------------------------------------------
    inline Vec2 Rect::tr()const noexcept {
        return center + Vec2(size.x * 0.5f, -size.y * 0.5f);
    }


    //@―---------------------------------------------------------------------------
    //! @brief      左下
    //@―---------------------------------------------------------------------------
    inline Vec2 Rect::bl()const noexcept {
        return center + Vec2(-size.x * 0.5f, size.y * 0.5f);
    }


    //@―---------------------------------------------------------------------------
    //! @brief      右下
    //@―---------------------------------------------------------------------------
    inline Vec2 Rect::br()const noexcept {
        return center + Vec2(size.x * 0.5f, size.y * 0.5f);
    }


    //@―---------------------------------------------------------------------------
    //! @brief      上辺の中央
    //@―---------------------------------------------------------------------------
    inline Vec2 Rect::topCenter()const noexcept {
        return Vec2(center.x, center.y - size.y * 0.5f);
    }


    //@―---------------------------------------------------------------------------
    //! @brief      下辺の中央
    //@―---------------------------------------------------------------------------
    inline Vec2 Rect::bottomCenter()const noexcept {
        return Vec2(center.x, center.y + size.y * 0.5f);
    }


    //@―---------------------------------------------------------------------------
    //! @brief      左辺の中央
    //@―---------------------------------------------------------------------------
    inline Vec2 Rect::leftCenter()const noexcept {
        return Vec2(center.x - size.x * 0.5f, center.y);
    }


    //@―---------------------------------------------------------------------------
    //! @brief      右辺の中央
    //@―---------------------------------------------------------------------------
    inline Vec2 Rect::rightCenter()const noexcept {
        return Vec2(center.x + size.x * 0.5f, center.y);
    }


    //@―---------------------------------------------------------------------------
    //! @brief      幅
    //@―---------------------------------------------------------------------------
    inline f32 Rect::width()const noexcept {
        return size.x;
    }


    //@―---------------------------------------------------------------------------
    //! @brief      高さ
    //@―---------------------------------------------------------------------------
    inline f32 Rect::height()const noexcept {
        return size.y;
    }


    //@―---------------------------------------------------------------------------
    //! @brief      面積
    //@―---------------------------------------------------------------------------
    inline f32 Rect::area()const noexcept {
        return size.x*size.y;
    }


    //@―---------------------------------------------------------------------------
    //! @brief      高さ
    //@―---------------------------------------------------------------------------
    inline f32 Rect::perimeter()const noexcept {
        return (size.x+size.y)*2.0f;
    }


    //@―---------------------------------------------------------------------------
    //! @brief      サイズが0以下であるか
    //@―---------------------------------------------------------------------------
    inline bool Rect::isEmpty()const noexcept {
        return size.isZero();
    }


    //@―---------------------------------------------------------------------------
    //! @brief      2点を指定して Rect を作成する
    //@―---------------------------------------------------------------------------
    inline Rect Rect::Create(const Vec2& start, const Vec2& end) noexcept {
        return Rect(start - end, (start + end) * 0.5f);
    }


    //@―---------------------------------------------------------------------------
    //! @brief      補間
    //! 
    //! @param a    開始
    //! @param b    終了
    //! @param t    補間係数
    //! @return     t=0のときa、t=1の時bを返す。
    //@―---------------------------------------------------------------------------
    inline Rect Lerp(const Rect& a, const Rect& b, f32 t) noexcept {
        return Rect(Vec2::Lerp(a.size,b.size,t),Vec2::Lerp(a.center,b.center,t));
    }


    //! @endcond
}// namespcae ob