//***********************************************************
//! @file
//! @brief		オイラー角回転構造体
//! @author		Gajumaru
//***********************************************************
#pragma once
#include <Framework/Core/Math/Quaternion.h>

namespace ob {

    struct Vec3;

    //@―---------------------------------------------------------------------------
    //! @brief      オイラー回転を表す構造体
    //! 
    //! @details    回転はZXYの順に行われる。
    //@―---------------------------------------------------------------------------
    struct OB_API Rotator {
    public:

        //===============================================================
        //  コンストラクタ / デストラクタ
        //===============================================================

        //@―---------------------------------------------------------------------------
        //! @brief  コンストラクタ(初期化なし)
        //@―---------------------------------------------------------------------------
        Rotator() = default;


        //@―---------------------------------------------------------------------------
        //! @brief  コンストラクタ(roll/pitch/yaw指定)
        //@―---------------------------------------------------------------------------
        Rotator(f32 roll, f32 pitch, f32 yaw)noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief  コンストラクタ(Vec3指定)
        //@―---------------------------------------------------------------------------
        explicit Rotator(const Vec3& vec)noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief  コンストラクタ(Quat指定)
        //@―---------------------------------------------------------------------------
        explicit Rotator(const Quat& quat);


        //===============================================================
        //  セッター
        //===============================================================

        //@―---------------------------------------------------------------------------
        //! @brief  コンストラクタ(roll/pitch/yaw指定)
        //@―---------------------------------------------------------------------------
        void set(f32 roll, f32 pitch, f32 yaw)noexcept;


        //@―---------------------------------------------------------------------------
        //! @brief  コンストラクタ(Vec3指定)
        //@―---------------------------------------------------------------------------
        void set(const Vec3& vec)noexcept;


        //===============================================================
        //  ゲッター
        //===============================================================

        //@―---------------------------------------------------------------------------
        //! @brief  Quatに変換
        //@―---------------------------------------------------------------------------
        Quat toQuat()const;


        //@―---------------------------------------------------------------------------
        //! @brief  正面ベクトルを取得
        //@―---------------------------------------------------------------------------
        Vec3 front()const;


        //@―---------------------------------------------------------------------------
        //! @brief  背面ベクトルを取得
        //@―---------------------------------------------------------------------------
        Vec3 back()const;


        //@―---------------------------------------------------------------------------
        //! @brief  上ベクトルを取得
        //@―---------------------------------------------------------------------------
        Vec3 up()const;


        //@―---------------------------------------------------------------------------
        //! @brief  下ベクトルを取得
        //@―---------------------------------------------------------------------------
        Vec3 down()const;


        //@―---------------------------------------------------------------------------
        //! @brief  左ベクトルを取得
        //@―---------------------------------------------------------------------------
        Vec3 left()const;


        //@―---------------------------------------------------------------------------
        //! @brief  右ベクトルを取得
        //@―---------------------------------------------------------------------------
        Vec3 right()const;


        //@―---------------------------------------------------------------------------
        //! @brief  正規化
        //@―---------------------------------------------------------------------------
        Rotator& normalize();


        //@―---------------------------------------------------------------------------
        //! @brief  NaNを含むか
        //@―---------------------------------------------------------------------------
        bool isNaN();

    public:

        static const Rotator zero;

    public:

        f32 roll;       //!< Z軸回転量
        f32 pitch;      //!< X軸回転量
        f32 yaw;        //!< Y軸回転量

    };






    //===============================================================
    // インライン関数
    //===============================================================
    //! @cond

    //@―---------------------------------------------------------------------------
    //! @brief  コンストラクタ(roll/pitch/yaw指定)
    //@―---------------------------------------------------------------------------
    inline Rotator::Rotator(f32 roll, f32 pitch, f32 yaw)noexcept {
        set(roll, pitch, yaw);
    }


    //@―---------------------------------------------------------------------------
    //! @brief  コンストラクタ(Vec3指定)
    //@―---------------------------------------------------------------------------
    inline Rotator::Rotator(const Vec3& vec)noexcept {
        set(vec);
    }


    //@―---------------------------------------------------------------------------
    //! @brief  コンストラクタ(Quat指定)
    //@―---------------------------------------------------------------------------
    inline Rotator::Rotator(const Quat& quat) {
        *this = quat.getRot();
    }


    //@―---------------------------------------------------------------------------
    //! @brief  コンストラクタ(roll/pitch/yaw指定)
    //@―---------------------------------------------------------------------------
    inline void Rotator::set(f32 roll, f32 pitch, f32 yaw)noexcept {
        this->roll = roll;
        this->pitch = pitch;
        this->yaw = yaw;
    }


    //@―---------------------------------------------------------------------------
    //! @brief  コンストラクタ(Vec3指定)
    //@―---------------------------------------------------------------------------
    inline void Rotator::set(const Vec3& vec)noexcept {
        set(vec.x, vec.y, vec.z);
    }


    //@―---------------------------------------------------------------------------
    //! @brief  Quatに変換
    //@―---------------------------------------------------------------------------
    inline Quat Rotator::toQuat()const {
        return Quat(roll, pitch, yaw);
    }


    //@―---------------------------------------------------------------------------
    //! @brief  正面ベクトルを取得
    //@―---------------------------------------------------------------------------
    inline Vec3 Rotator::front()const {
        return toQuat().getFront();
    }


    //@―---------------------------------------------------------------------------
    //! @brief  背面ベクトルを取得
    //@―---------------------------------------------------------------------------
    inline Vec3 Rotator::back()const {
        return toQuat().getBack();
    }


    //@―---------------------------------------------------------------------------
    //! @brief  上ベクトルを取得
    //@―---------------------------------------------------------------------------
    inline Vec3 Rotator::up()const {
        return toQuat().getUp();
    }


    //@―---------------------------------------------------------------------------
    //! @brief  下ベクトルを取得
    //@―---------------------------------------------------------------------------
    inline Vec3 Rotator::down()const{
        return toQuat().getDown();
    }


    //@―---------------------------------------------------------------------------
    //! @brief  左ベクトルを取得
    //@―---------------------------------------------------------------------------
    inline Vec3 Rotator::left()const{
        return toQuat().getLeft();
    }


    //@―---------------------------------------------------------------------------
    //! @brief  右ベクトルを取得
    //@―---------------------------------------------------------------------------
    inline Vec3 Rotator::right()const{
        return toQuat().getRight();
    }


    //@―---------------------------------------------------------------------------
    //! @brief  正規化
    //@―---------------------------------------------------------------------------
    inline Rotator& Rotator::normalize() {
        roll = Mathf::Mod(roll, Mathf::PI);
        pitch = Mathf::Mod(pitch, Mathf::PI);
        yaw = Mathf::Mod(yaw, Mathf::PI);
        if (roll < 0.0f)roll += Mathf::TWO_PI;
        if (pitch < 0.0f)pitch+= Mathf::TWO_PI;
        if (yaw < 0.0f)yaw += Mathf::TWO_PI;
    }


    //@―---------------------------------------------------------------------------
    //! @brief  NaNを含むか
    //@―---------------------------------------------------------------------------
    inline bool Rotator::isNaN() {
        return
            Mathf::IsNaN(roll) ||
            Mathf::IsNaN(pitch) ||
            Mathf::IsNaN(yaw);
    }

    //! @endcond
}// namespcae ob